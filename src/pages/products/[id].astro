---
import type { GetStaticPaths } from "astro";
import { getAllProducts, getProductById } from "../../services/products";
import Header from "../../layouts/Header.astro";
import ProductGallery from "../../components/preact/ProductGallery"
import Button from "../../components/Button.astro";

export const prerender = true
const { id } = Astro.params

if (!id) {
	return
}

const product = await getProductById({id})

if (!product) {
	return
}

export const getStaticPaths = (async () => {
	return getAllProducts().then(result => 
	result.map(product => ({
		params: { id: product.id}
	})))
}) satisfies GetStaticPaths;
---

<Header title={product?.title} search="">
    <main>
		<h2 class="text-3xl font-bold">{product?.title}</h2>
		<ProductGallery client:load images={product.images}/>
		<strong class="text-3xl mt-4 text-right self-end">{product.price}$</strong>
		<div class="flex gap-4 justify-evenly">
			<Button className="text-4xl font-normal py-4 px-8">Buy</Button>
			<Button className="text-4xl font-normal py-4 px-6">Share</Button>
		</div>
		<p>Brand: {product?.brand}</p>
		<p>Stock: {product?.stock}</p>
		<p>{product?.description}</p>
	</main>
</Header>